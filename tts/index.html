<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-Speech ElevenLabs (HTML)</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menambahkan font default yang lebih baik */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styling untuk audio player agar lebih konsisten */
        audio::-webkit-media-controls-panel {
            background-color: #374151; /* bg-gray-700 */
        }
        audio::-webkit-media-controls-play-button,
        audio::-webkit-media-controls-current-time-display,
        audio::-webkit-media-controls-time-remaining-display,
        audio::-webkit-media-controls-mute-button,
        audio::-webkit-media-controls-volume-slider {
            filter: invert(1);
        }
    </style>
</head>
<body class="bg-gray-900">

    <div class="min-h-screen text-white flex items-center justify-center p-4">
        <div class="w-full max-w-2xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6">
            <!-- Header -->
            <div class="text-center">
                <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                    Text-to-Speech ElevenLabs
                </h1>
                <p class="text-gray-400 mt-2">Ubah teks menjadi suara dengan mudah.</p>
            </div>

            <!-- Input API Key -->
            <div class="space-y-2">
                <label for="api-key" class="text-sm font-medium text-gray-300">Kunci API ElevenLabs Anda</label>
                <div class="flex items-center space-x-2">
                     <input
                        id="api-key-input"
                        type="password"
                        placeholder="Masukkan kunci API ElevenLabs di sini"
                        class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-200"
                    />
                    <button
                        id="fetch-voices-btn"
                        class="flex-shrink-0 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-purple-500"
                    >
                       Atur & Muat Suara
                    </button>
                </div>
                <p id="api-key-error" class="text-red-400 text-xs mt-1 hidden"></p>
                 <p class="text-xs text-gray-500 mt-1">
                  Dapatkan kunci API dari <a href="https://elevenlabs.io/" target="_blank" rel="noopener noreferrer" class="text-purple-400 hover:underline">situs web ElevenLabs</a>. Kunci tidak disimpan.
                </p>
            </div>

            <!-- Sisa Kuota Karakter -->
            <div class="space-y-2">
              <div class="flex justify-between items-center text-sm font-medium text-gray-300">
                <span>Sisa Kuota Karakter</span>
                <span id="remaining-chars-display">10000 / 10000</span>
              </div>
              <div class="w-full bg-gray-700 rounded-full h-2.5">
                <div 
                  id="quota-progress-bar"
                  class="bg-gradient-to-r from-purple-500 to-pink-500 h-2.5 rounded-full transition-all duration-500" 
                  style="width: 100%;">
                </div>
              </div>
            </div>

            <!-- Form utama -->
            <div class="space-y-4">
                <!-- Text Area -->
                <div>
                    <label for="text-input" class="text-sm font-medium text-gray-300 mb-2 block">Teks untuk diubah</label>
                    <textarea
                        id="text-input"
                        class="w-full h-36 bg-gray-700 border border-gray-600 rounded-lg p-4 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-200 resize-none"
                        placeholder="Masukkan teks di sini..."
                        disabled
                    >Halo! Selamat datang di aplikasi text-to-speech menggunakan ElevenLabs.</textarea>
                    <p id="char-counter" class="text-right text-sm mt-1 text-gray-400">
                        0 / 5000
                    </p>
                </div>

                <!-- Pemilihan Suara -->
                <div>
                    <label for="voice-select" class="text-sm font-medium text-gray-300 mb-2 block">Pilih Suara</label>
                    <select
                        id="voice-select"
                        class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-200"
                        disabled
                    >
                        <option value="">Masukkan API Key untuk memuat suara</option>
                    </select>
                </div>
                
                <!-- Tombol Generate & Audio Player -->
                <div class="flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0 sm:space-x-4">
                    <button
                        id="generate-speech-btn"
                        disabled
                        class="w-full sm:w-auto flex items-center justify-center gap-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    >
                        <!-- Ikon Play SVG -->
                        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                        <!-- Ikon Loader SVG -->
                        <svg id="loader-icon" class="animate-spin hidden" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg>
                        <span id="generate-btn-text">Hasilkan Suara</span>
                    </button>
                    
                    <div id="audio-player-container" class="w-full sm:w-auto"></div>
                </div>
            </div>
            
            <!-- Pesan Error -->
            <div id="error-container" class="bg-red-900/50 border border-red-500 text-red-300 px-4 py-3 rounded-lg relative flex items-center gap-3 hidden" role="alert">
                <!-- Ikon Error SVG -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                <span id="error-message"></span>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Konfigurasi dan Variabel State ---
            const MAX_QUOTA = 10000;
            const MAX_PER_GENERATION = 5000;
            let apiKey = '';
            let remainingChars = MAX_QUOTA;
            let isLoading = false;

            // --- Referensi Elemen DOM ---
            const apiKeyInput = document.getElementById('api-key-input');
            const fetchVoicesBtn = document.getElementById('fetch-voices-btn');
            const apiKeyError = document.getElementById('api-key-error');
            
            const remainingCharsDisplay = document.getElementById('remaining-chars-display');
            const quotaProgressBar = document.getElementById('quota-progress-bar');
            
            const textInput = document.getElementById('text-input');
            const charCounter = document.getElementById('char-counter');
            const voiceSelect = document.getElementById('voice-select');
            
            const generateSpeechBtn = document.getElementById('generate-speech-btn');
            const generateBtnText = document.getElementById('generate-btn-text');
            const playIcon = document.getElementById('play-icon');
            const loaderIcon = document.getElementById('loader-icon');
            
            const audioPlayerContainer = document.getElementById('audio-player-container');
            
            const errorContainer = document.getElementById('error-container');
            const errorMessage = document.getElementById('error-message');

            // --- Fungsi Helper UI ---
            const showError = (message) => {
                errorMessage.textContent = message;
                errorContainer.classList.remove('hidden');
            };

            const hideError = () => {
                errorContainer.classList.add('hidden');
            };

            const setLoadingState = (button, loading, text) => {
                isLoading = loading;
                button.disabled = loading;
                generateBtnText.textContent = text;
                if (loading) {
                    playIcon.classList.add('hidden');
                    loaderIcon.classList.remove('hidden');
                } else {
                    playIcon.classList.remove('hidden');
                    loaderIcon.classList.add('hidden');
                }
            };

            const updateCharCounter = () => {
                const len = textInput.value.length;
                charCounter.textContent = `${len} / ${MAX_PER_GENERATION}`;
                charCounter.classList.toggle('text-red-400', len >= MAX_PER_GENERATION);
                generateSpeechBtn.disabled = len === 0 || len > remainingChars || isLoading;
            };

            const updateQuotaDisplay = () => {
                remainingCharsDisplay.textContent = `${remainingChars} / ${MAX_QUOTA}`;
                const percentage = (remainingChars / MAX_QUOTA) * 100;
                quotaProgressBar.style.width = `${percentage}%`;
            };

            // --- Logika Inti ---
            const fetchVoices = async () => {
                apiKey = apiKeyInput.value;
                if (!apiKey) {
                    apiKeyError.textContent = 'Kunci API diperlukan untuk mengambil daftar suara.';
                    apiKeyError.classList.remove('hidden');
                    return;
                }

                fetchVoicesBtn.disabled = true;
                fetchVoicesBtn.textContent = 'Memuat...';
                hideError();
                apiKeyError.classList.add('hidden');

                try {
                    const response = await fetch('https://api.elevenlabs.io/v1/voices', {
                        headers: { 'xi-api-key': apiKey }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail.message || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    voiceSelect.innerHTML = ''; // Hapus opsi lama
                    if (data.voices.length > 0) {
                        const defaultOption = document.createElement('option');
                        defaultOption.value = "";
                        defaultOption.textContent = "-- Pilih Suara --";
                        voiceSelect.appendChild(defaultOption);

                        data.voices.forEach(voice => {
                            const option = document.createElement('option');
                            option.value = voice.voice_id;
                            option.textContent = `${voice.name} (${voice.labels.gender}, ${voice.labels.accent})`;
                            voiceSelect.appendChild(option);
                        });
                        
                        // Aktifkan form setelah suara berhasil dimuat
                        textInput.disabled = false;
                        voiceSelect.disabled = false;
                        generateSpeechBtn.disabled = false;
                    } else {
                         const option = document.createElement('option');
                         option.value = "";
                         option.textContent = "Tidak ada suara tersedia";
                         voiceSelect.appendChild(option);
                    }

                } catch (e) {
                    showError(`Gagal mengambil suara: ${e.message}. Pastikan kunci API Anda valid.`);
                } finally {
                    fetchVoicesBtn.disabled = false;
                    fetchVoicesBtn.textContent = 'Atur & Muat Suara';
                }
            };
            
            const generateSpeech = async () => {
                const text = textInput.value.trim();
                const voiceId = voiceSelect.value;
                
                // Validasi
                if (!text) {
                    showError('Teks tidak boleh kosong.');
                    return;
                }
                if (text.length > remainingChars) {
                    showError(`Kuota karakter tidak mencukupi. Sisa kuota Anda: ${remainingChars}.`);
                    return;
                }
                if (!voiceId) {
                    showError('Silakan pilih suara terlebih dahulu.');
                    return;
                }

                hideError();
                setLoadingState(generateSpeechBtn, true, 'Menghasilkan...');
                audioPlayerContainer.innerHTML = '';

                try {
                    const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'xi-api-key': apiKey,
                        },
                        body: JSON.stringify({
                            text: text,
                            model_id: "eleven_multilingual_v2",
                            voice_settings: { stability: 0.5, similarity_boost: 0.75 }
                        }),
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.detail.message || `HTTP error! status: ${response.status}`);
                    }

                    const audioBlob = await response.blob();
                    const url = URL.createObjectURL(audioBlob);
                    
                    // Buat elemen audio
                    const audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = url;
                    audio.className = 'w-full sm:w-auto rounded-lg';
                    audioPlayerContainer.appendChild(audio);

                    // Kurangi kuota dan perbarui tampilan
                    remainingChars -= text.length;
                    updateQuotaDisplay();
                    updateCharCounter();

                } catch(e) {
                    showError(`Gagal menghasilkan audio: ${e.message}`);
                } finally {
                    setLoadingState(generateSpeechBtn, false, 'Hasilkan Suara');
                }
            };

            // --- Event Listeners ---
            fetchVoicesBtn.addEventListener('click', fetchVoices);
            generateSpeechBtn.addEventListener('click', generateSpeech);
            
            textInput.addEventListener('input', () => {
                const text = textInput.value;
                if (text.length > MAX_PER_GENERATION) {
                    textInput.value = text.slice(0, MAX_PER_GENERATION);
                }
                updateCharCounter();
            });

            // --- Inisialisasi ---
            updateCharCounter();
            updateQuotaDisplay();
        });
    </script>

</body>
  </html>
  
